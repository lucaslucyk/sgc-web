const rpp = $("#results_per_page"); async function append_order(a) { var e = localStorage.getItem("order_by"); null == e ? (e = a, localStorage.setItem("order_by", a)) : (e.indexOf(a) >= 0 ? e = e.indexOf("-" + a) >= 0 ? e.replace("-" + a, a) : e.replace(a, "-" + a) : e += "," + a, localStorage.order_by = e), get_classes(localStorage.getItem("page"), e) } async function get_classes(a, e) { $(".overlay").show("fast"); var t = rpp.children("option:selected").val(), s = $("#formFiltros").serializeArray(); s.push({ name: "order_by", value: e }), s.push({ name: "page", value: a }), s.push({ name: "rpp", value: t }); var l = window.location.href; $.ajax({ type: "POST", dataType: "json", url: l, data: s, success: function (a) { update_table(a.results), update_paginator(a.pages, a.page) } }) } async function update_paginator(a, e) { $("#paginatorNav ul li").remove(), $("#paginatorNav ul").append('    <li class="page-item ' + (e <= 1 ? "disabled" : "") + '">      <a class="page-link" href="#" tabindex="' + (-1 * parseInt(e) + 1) + '">        <i class="fas fa-step-backward"></i>      </a>    </li>  '), $("#paginatorNav ul").append('    <li class="page-item ' + (e <= 1 ? "disabled" : "") + '">      <a class="page-link" href="#" tabindex="-1">Anterior</a>    </li>  '), $.each(getPageList(a, e, 7), function (a, t) { $("#paginatorNav ul").append('      <li class="page-item ' + (t == e ? "active" : "") + (0 == t ? "disabled" : "") + '">        <a class="page-link" href="#">' + (t > 0 ? t : "...") + "</a>      </li>    ") }), $("#paginatorNav ul").append('    <li class="page-item ' + (e == a || 0 == a ? "disabled" : "") + '">      <a class="page-link" href="#" tabindex="1">Siguiente</a>    </li>  '), $("#paginatorNav ul").append('    <li class="page-item ' + (e == a || 0 == a ? "disabled" : "") + '">      <a class="page-link" href="#" tabindex="' + (parseInt(a) - parseInt(e)) + '">        <i class="fas fa-step-forward"></i>      </a>    </li>  '), $(".overlay").hide("fast") } async function update_table(a) { $("#clasesResults tr").remove(), $.each(a, function (a, e) { $("#clasesResults").append("<tr></tr>"), $("#clasesResults tr:last").append('      <td class="align-middle">        <div class="form-check-inline">          <input type="checkbox" id="toProcess_' + e.id + '" name="toProcess_' + e.id + '" class="form-check-input check_clases">        </div>      </td>      <td class="align-middle">' + e.estado + '</td>      <td class="align-middle text-center"><i class="fas fa-' + (e.was_made ? "check" : "times") + '-circle"></i></td>      <td class="align-middle">' + e.empleado + '</td>      <td class="align-middle">' + (e.reemplazo ? "<strong>" + e.reemplazo + "</strong>" : e.empleado) + '</td>      <td class="align-middle">' + e.sede + '</td>      <td class="align-middle">' + e.actividad + '</td>      <td class="align-middle">' + e.dia_semana + '</td>      <td class="align-middle">' + $.format.date(new Date(e.fecha.split("-")), "d MMMM yyyy") + '</td>      <td class="align-middle">' + e.horario_desde + '</td>      <td class="align-middle">' + e.horario_hasta + '</td>      <td class="align-middle">' + e.ausencia + '</td>      <td class="align-middle text-center"><i class="fas fa-' + (e.confirmada ? "check" : "times") + '-circle"></i></td>      <td class="align-middle">' + (e.comentarios ? '<i class="far fa-comments">&nbsp;<sup><span class="badge bg-info">' + e.comentarios + "</span></sup></i>" : "&nbsp;") + "</td>    ") }) } function getPageList(a, e, t) { if (t < 5) throw "maxLength must be at least 5"; function s(a, e) { return Array.from(Array(e - a + 1), (e, t) => t + a) } var l = t < 9 ? 1 : 2, i = t - 2 * l - 3 >> 1, r = t - 2 * l - 2 >> 1; return a <= t ? s(1, a) : e <= t - l - 1 - r ? s(1, t - l - 1).concat(0, s(a - l + 1, a)) : e >= a - l - 1 - r ? s(1, l).concat(0, s(a - l - 1 - r - i, a)) : s(1, l).concat(0, s(e - i, e + r), 0, s(a - l + 1, a)) } function clean_localStorage() { localStorage.removeItem("order_by"), localStorage.removeItem("page") } $("#results_per_page").change(function () { get_classes(1, localStorage.getItem("order_by")) }), $("#formFiltros").submit(function (a) { a.preventDefault(), $("body").addClass("sidebar-collapse"), $("#logo-big").hide("fast"), $("#logo-small").show("fast"), $("#actions_results").show("slow"), $("html, body").animate({ scrollTop: $("#actions_results").offset().top }, 1e3), $("[view-model-order=true] i").hide(), clean_localStorage(), $("[view-model-order=true] i").removeClass("flipp").addClass("flipper"), get_classes(1, "fecha") }), $("[view-model-order=true]").click(function (a) { a.preventDefault(), $(this).children("i").show().toggleClass("flipper flipp"), append_order($(this).attr("data-order")) }), $("#paginatorNav ul").on("click", "li a", function (a) { a.preventDefault(); var e = parseInt($(this).text()), t = parseInt($("#paginatorNav ul li.active a").text()); isNaN(e) && (e = t + parseInt($(this).attr("tabindex"))); localStorage.setItem("page", e), get_classes(e, localStorage.getItem("order_by")), $("html, body").animate({ scrollTop: $("#actions_results").offset().top }, 500) }), $(document).ready(function () { clean_localStorage() });